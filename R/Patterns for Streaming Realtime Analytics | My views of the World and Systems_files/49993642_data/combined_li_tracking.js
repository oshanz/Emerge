!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("liTrackClient",[],t):e.liTrackClient=t()}(this,function(){var e={AJAX_METHOD:"POST",DEFAULT_PAGE_TYPE:"ajax",globalTrackingUrl:null,globalTrackingAppId:"no.app.id",lastDisplayMetric:null,lastActionMetric:null,queue:[],maxQueueSize:1,queueTimeout:1e3,timeoutId:null,csrfToken:"",setProperty:function(e,t){if(t)return void(this[e]=t);var i=this.getMetaTag(e);return i?void(this[e]=i.content):void 0},setTrackingUrl:function(e){this.setProperty("globalTrackingUrl",e)},setAppId:function(e){this.setProperty("globalTrackingAppId",e)},setCsrfToken:function(e){this.setProperty("csrfToken",e)},getCookieString:function(){return document.cookie},getCsrfToken:function(){for(var e="JSESSIONID=",t=this.getCookieString().split(";"),i=0;i<t.length;i++){for(var r=t[i];" "===r.charAt(0);)r=r.substring(1);if(-1!==r.indexOf(e)){var n=r.substring(e.length,r.length);return'"'===n[0]&&'"'===n[n.length-1]&&(n=n.substring(1,n.length-1)),n}}return""},createXmlHttpObject:function(){try{return new XMLHttpRequest}catch(e){}return null},ajax:function(e,t,i){var r;return this.globalTrackingUrl?(r=this.createXmlHttpObject(),void(r&&(r.open(this.AJAX_METHOD,this.globalTrackingUrl,!0),r.withCredentials=!0,r.setRequestHeader("Content-type","application/json"),this.csrfToken?r.setRequestHeader("Csrf-Token",this.csrfToken):r.setRequestHeader("Csrf-Token",this.getCsrfToken()),r.onreadystatechange=function(){return 4===r.readyState?200!==r.status&&304!==r.status?void(i&&i("Request returned "+r.status)):void("function"==typeof t&&t(r)):void 0},4!==r.readyState&&r.send(e)))):void(i&&i("Tracking url is not defined"))},flush:function(){var e=this;this.ajax(JSON.stringify(this.queue),null,e.logError),this.queue=[],clearTimeout(this.timeoutId),this.timeoutId=null},addToQueue:function(e){if(this.queue.push(e),this.queue.length>=this.maxQueueSize)return this.flush();if(!this.timeoutId){var t=this;this.timeoutId=setTimeout(function(){t.flush()},this.queueTimeout)}},track:function(e){return"object"!=typeof e?void this.logError("Track data must be an object"):(e=this.fillMissingData(e),void this.addToQueue(e))},trackWithCallback:function(e,t){var i=this;if("object"!=typeof e)return void this.logError("Track data must be an object");e=this.fillMissingData(e);var r=JSON.stringify(e);this.ajax(r,function(e){"function"==typeof t&&t(null,e.responseText)},function(e){i.logError(e),"function"==typeof t&&t(e)})},getTimestamp:function(){return Math.round((new Date).getTime()/1e3)},getTrackingCode:function(e){return e.eventBody.trackingCode?e.eventBody.trackingCode:"PageViewEvent"===e.eventInfo.eventName?"full"===e.eventBody.pageType?(this.lastDisplayMetric=e.eventBody.requestHeader.pageKey,this.lastActionMetric):(this.lastActionMetric=e.eventBody.requestHeader.pageKey,this.lastDisplayMetric):null},fillMissingData:function(e){if(!e.eventInfo)return this.logError("You must specify eventInfo");if(e.eventInfo.appId||(e.eventInfo.appId=this.globalTrackingAppId),!e.eventBody)return this.logError("You must specify eventBody");e.eventBody.trackingCode=this.getTrackingCode(e);var t=e.eventBody.trackingInfo||{};t.clientTimestamp||(t.clientTimestamp=this.getTimestamp()),e.eventBody.trackingInfo=t;var i=e.eventBody.requestHeader||{};return i.pageKey||(i.pageKey=this.lastDisplayMetric),e.eventBody.requestHeader=i,e},trackPageView:function(e){var t,i,r,n;"string"==typeof e?(t=e,n=this.DEFAULT_PAGE_TYPE):(t=e.pageKey,n=e.pageType||this.DEFAULT_PAGE_TYPE,i=e.trackingCode,r=e.trackingInfo);var o={eventInfo:{eventName:"PageViewEvent"},eventBody:{requestHeader:{pageKey:t},pageType:n}};return i&&(o.eventBody.trackingCode=i),r&&(o.eventBody.trackingInfo=r),t?void this.track(o):this.logError("You must provide a pageKey")},trackUnifiedAction:function(e){if(!e.action)return this.logError("You must provide action");if(!e.sponsoredFlag)return this.logError("You must provide sponsoredFlag");var t={eventInfo:{eventName:"UnifiedActionEvent"},eventBody:e};this.track(t)},trackArticleView:function(e){if(!e.articleId)return this.logError("You must provide articleId");var t={eventInfo:{eventName:"ArticleViewEvent"},eventBody:e};this.track(t)},trackUnifiedImpression:function(e){if(!e.results)return this.logError("You must provide results");var t={eventInfo:{eventName:"UnifiedImpressionEvent"},eventBody:e};this.track(t)},logError:function(e){var t=window.console;t&&t.error&&t.error(e)},getMetaTag:function(e){var t,i,r,n=document.getElementById(e)||document.querySelector&&document.querySelector("meta[name="+e+"]");if(n)return n;for(t=document.getElementsByTagName("meta"),r=t.length,i=0;r>i;i++)if(t[i].getAttribute("name")===e)return t[i];return null},init:function(){this.setTrackingUrl(),this.setAppId()}};return e.init(),e}),function(e){e.initTrackingLibrary=function(e){"undefined"!==liTrackClient&&(liTrackClient.setTrackingUrl(),liTrackClient.setAppId(e))},e.getUserRequestHeader=function(e){return{pageKey:e}},e.recordLeadTrackingEvent=function(t,i,r,n,o,a,l){var c={eventInfo:{eventName:t,appId:"slideshare.js.tracking.leads"},eventBody:{requestHeader:e.getUserRequestHeader(o),trackingId:i,leadCampaignInfo:{slideshowUrn:"urn:li:slideShareSlideshow:"+r,leadCampaignUrn:"urn:li:slideshareLeadCampaign:"+n},triggerInfo:{trigger:a,slideNumber:l}}};liTrackClient.track(c)},e.recordTrackingEvent=function(e,t,i){var r={eventInfo:{eventName:t,appId:e},eventBody:i};liTrackClient.track(r)}}(slideshare_object),function(e){function t(e){return e=e||"",e.charAt(0).toUpperCase()+e.slice(1)}function i(e,i){return i?"urn:li:slideShare"+t(e)+":"+i:null}function r(e){e=e||16;for(var t="";e--;)t+=Math.floor(16*Math.random()).toString(16).toUpperCase();return t}function n(){var e=/^pagekey-(.+)$/.exec(document.body.id);return e?e[1]:"PAGE_KEY_NOT_SET"}function o(t){window.liTrackClient&&(window.liTrackClient.setTrackingUrl(),window.liTrackClient.setAppId(g),this.pageKey=n(),this.trackingId=t.trackingId||r(),this.referrerParam=t.referrerParam||"rftp",this.userIsOwner=t.userIsOwner,this.appId=t.appId||g+".clipping",this.bodyDefaults={clippingSessionId:this.trackingId,header:{applicationViewerUrn:i("user",(e.user||{}).id)},requestHeader:{pageKey:this.pageKey,path:window.document.location.pathname,userAgent:navigator&&navigator.userAgent}})}var a={single:"SINGLE",bulk:"BATCH "},l={add:"ADD",copy:"COPY",move:"MOVE",remove:"REMOVE",reorder:"REORDER"},c={SlideShareClipActionEvent:"SlideShareClipActionEvent",SlideShareClipOrganizeActionEvent:"SlideShareClipOrganizeActionEvent",SlideShareClipboardActionEvent:"SlideShareClipboardActionEvent",SlideShareClippingClickEvent:"SlideShareClippingClickEvent",SlideShareClippingShareEvent:"SlideShareClippingShareEvent",SlideShareClippingViewEvent:"SlideShareClippingViewEvent"},p={addSingleClip:{quantityType:a.single,actionType:l.add},copySingleClip:{quantityType:a.single,actionType:l.copy},moveSingleClip:{quantityType:a.single,actionType:l.move},removeSingleClip:{quantityType:a.single,actionType:l.remove},reorderSingleClip:{quantityType:a.single,actionType:l.reorder},addMultipleClips:{quantityType:a.bulk,actionType:l.add},copyMultipleClips:{quantityType:a.bulk,actionType:l.copy},moveMultipleClips:{quantityType:a.bulk,actionType:l.move},removeMultipleClips:{quantityType:a.bulk,actionType:l.remove},reorderMultipleClips:{quantityType:a.bulk,actionType:l.reorder}},s={clickClipButton:"CLIP",clickViewToGrid:"CHANGE_VIEW_TO_GRID",clickViewToList:"CHANGE_VIEW_TO_LIST",clickTopNavMyClipboards:"CLIPBOARDS_NAV",clickClipThumbnail:"CLIP_THUMBNAIL",clickProfileMyClipboards:"PROFILE_DROPDOWN",clickShareClip:"SHARE_CLIP",clickShareClipboard:"SHARE_CLIPBOARD",clickSharePrompt:"SHARE_PROMPT_CTA"},d={clip:"clip",clipboard:"clipboard",slideshow:"slideshow"},u={directlink:"DIRECT_LINK",email:"EMAIL",facebook:"FACEBOOK",googleplus:"GOOGLE_PLUS",linkedin:"LINKEDIN",pinterest:"PINTEREST",twitter:"TWITTER"},g="slideshare.js.tracking";o.prototype.track=function(e,t){return window.liTrackClient.track({eventInfo:{eventName:e,appId:this.appId},eventBody:$.extend({},this.bodyDefaults,t)})},o.prototype.clipAction=function(e){var t=e.clip;return this.track(c.SlideShareClipActionEvent,{actionType:e.actionType,clipboardUrn:i(d.clipboard,e.clipboardId||e.clipboard_id),clipUrn:i(d.clip,t.id),slideshowUrn:i(d.slideshow,t.slideshowId||t.slideshow_id),position:t.position})},o.prototype.createClip=function(e,t){return this.clipAction({actionType:"CREATE",clip:e,clipboardId:t})},o.prototype.deleteClip=function(e){return this.clipAction({actionType:"DELETE",clip:e})},o.prototype.clipboardAction=function(e){var t=e.clipboard;return this.track(c.SlideShareClipboardActionEvent,{actionType:e.actionType,clipboardUrn:i(d.clipboard,t.id),title:t.title,isPrivate:t["private"]})},o.prototype.createClipboard=function(e){return this.clipboardAction({actionType:"CREATE",clipboard:e})},o.prototype.deleteClipboard=function(e){return this.clipboardAction({actionType:"DELETE",clipboard:e})},o.prototype.editClipboard=function(e,t){var i={id:e.id};return Object.keys(e).forEach(function(r){e[r]!==t[r]&&(i[r]=e[r])}),this.clipboardAction({actionType:"EDIT",clipboard:i})},o.prototype.pageView=function(e){return this.track(c.SlideShareClippingViewEvent,{clipboardUrn:i(d.clipboard,e),isOwner:this.userIsOwner,referrerType:(window.getUrlVar(this.referrerParam)||"").toUpperCase()})},o.prototype.clipOrganizeAction=function(e){return this.track(c.SlideShareClipOrganizeActionEvent,{actionType:e.actionType,quantityType:e.quantityType,clipUrns:e.clipIds.map(i.bind(null,"clip")),sourceClipboardUrn:i(d.clipboard,e.sourceClipboardId),targetClipboardUrn:i(d.clipboard,e.targetClipboardId)})},[d.clip,d.clipboard].forEach(function(e){o.prototype["share"+t(e)]=function(t,r){return this.track(c.SlideShareClippingShareEvent,{entityUrn:i(e,t),shareType:u[r]||r,isOwner:this.userIsOwner})}}),Object.keys(p).forEach(function(e){var t=p[e];o.prototype[e]=function(e,i,r){return this.clipOrganizeAction({actionType:t.actionType,quantityType:t.quantityType,clipIds:$.isArray(e)?e:[e],sourceClipboardId:i,targetClipboardId:r})}}),Object.keys(s).forEach(function(e){var t=s[e];o.prototype[e]=function(e,r){return this.track(c.SlideShareClippingClickEvent,{actionType:t,clipUrn:i(d.clip,r),clipboardUrn:i(d.clipboard,e),isOwner:this.userIsOwner})}}),e.ClippingTracker=o}(window.slideshare_object);